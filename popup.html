<!doctype html>
<html>
  <head>
    <title>GitLab Time Tracker</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        width: 320px;
        background: #fafafa;
        color: #303030;
      }

      .header {
        background: #fc6d26;
        color: white;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .header svg {
        width: 20px;
        height: 20px;
      }

      .header h1 {
        font-size: 14px;
        font-weight: 600;
      }

      .timer-section {
        padding: 16px;
        background: white;
        border-bottom: 1px solid #e5e5e5;
      }

      .timer-active {
        text-align: center;
      }

      .timer-issue {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .timer-issue a {
        color: #fc6d26;
        text-decoration: none;
      }

      .timer-issue a:hover {
        text-decoration: underline;
      }

      .timer-time {
        font-size: 36px;
        font-weight: 600;
        font-family: "SF Mono", Monaco, monospace;
        color: #554488;
        margin: 8px 0;
      }

      .timer-actions {
        margin-top: 12px;
        display: flex;
        gap: 8px;
        justify-content: center;
      }

      .btn {
        border: none;
        border-radius: 4px;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background-color 0.2s;
      }

      .btn-stop {
        background: #554488;
        color: white;
      }

      .btn-stop:hover {
        background: #453574;
      }

      .cancel-link {
        background: none;
        border: none;
        color: #888;
        font-size: 12px;
        padding: 4px 8px;
        cursor: pointer;
      }

      .cancel-link:hover {
        color: #554488;
      }

      .btn-start {
        background: #fc6d26;
        color: white;
      }

      .btn-start:hover {
        background: #e85d1a;
      }

      .btn-sm {
        padding: 4px 8px;
        font-size: 11px;
      }

      .no-timer {
        text-align: center;
        color: #888;
        font-size: 13px;
        padding: 8px 0;
      }

      .section {
        padding: 12px 16px;
        background: white;
        border-bottom: 1px solid #e5e5e5;
      }

      .section-header {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        color: #666;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .search-box {
        position: relative;
        margin-bottom: 8px;
      }

      .search-box input {
        width: 100%;
        padding: 8px 12px 8px 32px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
        outline: none;
      }

      .search-box input:focus {
        border-color: #fc6d26;
      }

      .search-box svg {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        width: 14px;
        height: 14px;
        color: #888;
      }

      .search-box .clear-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #888;
        padding: 2px;
        display: none;
      }

      .search-box .clear-btn.visible {
        display: block;
      }

      .search-box .clear-btn:hover {
        color: #333;
      }

      .task-list {
        list-style: none;
        max-height: 300px;
        overflow-y: auto;
      }

      .task-item {
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .task-item:last-child {
        border-bottom: none;
      }

      .task-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .fav-btn {
        flex-shrink: 0;
      }

      .task-info {
        flex: 1;
        min-width: 0;
      }

      .task-title {
        font-size: 13px;
        color: #303030;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .task-title a {
        color: #303030;
        text-decoration: none;
      }

      .task-title a:hover {
        color: #fc6d26;
      }

      .task-meta {
        font-size: 11px;
        color: #888;
      }

      .task-actions {
        display: flex;
        gap: 2px;
      }

      .icon-btn {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #888;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .icon-btn:hover {
        background: #f0f0f0;
        color: #fc6d26;
      }

      .icon-btn.favorite {
        color: #f5a623;
      }

      .icon-btn.delete:hover {
        color: #554488;
      }

      .icon-btn svg {
        width: 16px;
        height: 16px;
      }

      .empty-state {
        text-align: center;
        color: #888;
        font-size: 12px;
        padding: 12px 0;
      }

      .time-entry {
        display: flex;
        gap: 6px;
        margin-top: 8px;
        padding: 10px;
        background: #f0f4f8;
        border-radius: 6px;
        border: 1px solid #e0e6ed;
        animation: slideDown 0.15s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .time-entry input {
        flex: 1;
        padding: 6px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
        min-width: 0;
      }

      .time-entry input:focus {
        outline: none;
        border-color: #fc6d26;
        box-shadow: 0 0 0 2px rgba(252, 109, 38, 0.1);
      }

      .footer {
        padding: 12px 16px;
        display: flex;
        justify-content: flex-end;
      }

      .footer a {
        font-size: 12px;
        color: #666;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .footer a:hover {
        color: #fc6d26;
      }

      .footer svg {
        width: 14px;
        height: 14px;
      }

      .message {
        padding: 8px 12px;
        margin-bottom: 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        text-align: center;
      }

      .message.success {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .message.error {
        background: #fde8e8;
        color: #c62828;
      }

      /* Views */
      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      /* Settings */
      .settings-header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: white;
        border-bottom: 1px solid #e5e5e5;
      }

      .back-btn {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #666;
        display: flex;
        align-items: center;
        border-radius: 4px;
      }

      .back-btn:hover {
        background: #f0f0f0;
        color: #fc6d26;
      }

      .back-btn svg {
        width: 18px;
        height: 18px;
      }

      .settings-title {
        font-size: 14px;
        font-weight: 600;
        color: #303030;
      }

      .settings-form {
        padding: 16px;
        background: white;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        color: #666;
        margin-bottom: 6px;
      }

      .form-group input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 13px;
        outline: none;
      }

      .form-group input:focus {
        border-color: #fc6d26;
        box-shadow: 0 0 0 2px rgba(252, 109, 38, 0.1);
      }

      .form-group .hint {
        font-size: 11px;
        color: #888;
        margin-top: 4px;
      }

      .settings-actions {
        margin-top: 20px;
      }

      .btn-save {
        width: 100%;
        background: #fc6d26;
        color: white;
        padding: 10px 16px;
        font-size: 13px;
        font-weight: 500;
      }

      .btn-save:hover {
        background: #e85d1a;
      }

      .footer-btn {
        background: none;
        border: none;
        font-size: 12px;
        color: #666;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0;
      }

      .footer-btn:hover {
        color: #fc6d26;
      }

      .footer-btn svg {
        width: 14px;
        height: 14px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <svg viewBox="0 0 100 100" fill="currentColor">
        <g fill="none" stroke="currentColor" stroke-width="8">
          <circle cx="50" cy="55" r="40" />
          <g stroke-linecap="round">
            <line x1="40" y1="8" x2="60" y2="8" />
            <line x1="50" y1="8" x2="50" y2="15" />
          </g>
        </g>
        <polygon points="42,45 68,55 42,65" fill="currentColor" />
      </svg>
      <h1>GitLab Time Tracker</h1>
    </div>

    <!-- Tasks View -->
    <div id="tasks-view" class="view active">
      <div class="timer-section">
        <div id="timer-display">
          <!-- Timer info will be injected here -->
        </div>
      </div>

      <div class="section">
        <div class="search-box">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="11" cy="11" r="8" />
            <path d="M21 21l-4.35-4.35" />
          </svg>
          <input type="text" id="search-input" placeholder="Search issues..." />
          <button class="clear-btn" id="clear-search">
            <svg
              viewBox="0 0 24 24"
              width="14"
              height="14"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </button>
        </div>
        <ul id="task-list" class="task-list">
          <!-- Tasks will be listed here -->
        </ul>
      </div>

      <div class="footer">
        <button class="footer-btn" id="open-settings">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="3" />
            <path
              d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
            />
          </svg>
          Settings
        </button>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settings-view" class="view">
      <div class="settings-header">
        <button class="back-btn" id="back-to-tasks">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
        </button>
        <span class="settings-title">Settings</span>
      </div>

      <div class="settings-form">
        <div class="form-group">
          <label for="gitlab-url">GitLab URL</label>
          <input type="text" id="gitlab-url" placeholder="https://gitlab.com" />
          <div class="hint">
            Your GitLab instance URL (without trailing slash)
          </div>
        </div>

        <div class="form-group">
          <label for="api-token">Personal Access Token</label>
          <input
            type="password"
            id="api-token"
            placeholder="Enter your token"
          />
          <div class="hint">
            Create one in GitLab → Settings → Access Tokens
          </div>
        </div>

        <div class="settings-actions">
          <button class="btn btn-save" id="save-settings">Save Settings</button>
        </div>

        <div id="settings-message"></div>
      </div>
    </div>

    <script src="popup.js"></script>
  </body>
</html>
